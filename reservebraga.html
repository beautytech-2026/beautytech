<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Reserva de HorÃ¡rio</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pikaday/css/pikaday.css">
  <style>
    body {
  background: linear-gradient(to bottom right, #dd0583, #8e2de2);
  font-family: 'Vazirmatn', sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
  padding: 30px;
  overflow-x: hidden;
  position: relative;
}

    .container {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 30px;
      max-width: 440px;
      width: 100%;
      box-shadow: 0 0 20px #e178f4;
      color: white;
    }
    h2 {
      text-align: center;
      margin-bottom: 25px;
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: bold;
    }
    input, button, select {
      width: 100%;
      padding: 10px;
      margin-bottom: 16px;
      border-radius: 8px;
      border: none;
      font-size: 15px;
    }
    input, select {
      background: rgba(255, 255, 255, 0.2);
      color: #c13a8f;
    }
    button {
      background: #c02190;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    .slot-button {
      display: inline-block;
      padding: 8px 12px;
      border-radius: 6px;
      margin: 5px 5px 10px 0;
      background: #fff;
      color: #ae6de8;
      cursor: pointer;
      border: none;
    }
    .slot-button.selected {
      background: #d81e6f;
      color: white;
    }
    .logo {
  margin-top: 10px;
  margin-bottom: 20px;
  display: flex;
  justify-content: center;
  align-items: center;
}

.logo img {
  max-height: 100px;
  height: auto;
  width: auto;
}



.logo img {
  max-height: 200px;
  width: auto;
}
.back-button {
  position: fixed;
  top: 20px;
  left: 20px;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(6px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 999;
  transition: background 0.3s ease;
}

.back-button:hover {
  background: rgba(255, 255, 255, 0.3);
}

.back-button svg {
  width: 24px;
  height: 24px;
}

/* Hamburger button */
.hamburger {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1001;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.hamburger div {
  width: 30px;
  height: 4px;
  background-color: #fff;
  border-radius: 2px;
}

/* Glass menu container */
.glass-menu {
  position: fixed;
  top: -100%;
  left: 0;
  width: 100%;
  padding: 80px 20px 30px;
  backdrop-filter: blur(15px);
  background: rgba(255, 255, 255, 0.15);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  border-bottom: 1px solid rgba(255, 255, 255, 0.2);
  transition: top 0.5s ease-in-out;
  z-index: 1000;
}

.glass-menu ul {
  list-style: none;
  padding: 0;
  margin: 0;
  text-align: center;
}

.glass-menu li {
  margin-bottom: 20px;
  font-size: 20px;
  color: #fff;
  cursor: pointer;
  font-weight: bold;
}

.glass-menu a {
  color: #fff;
  text-decoration: none;
}

.submenu {
  display: none;
  margin-top: 10px;
}

.submenu li {
  font-size: 16px;
  font-weight: normal;
  margin-top: 5px;
}

/* Show menu */
.glass-menu.open {
  top: 0;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .glass-menu {
    padding-top: 60px;
  }

  .hamburger {
    top: 15px;
    right: 15px;
  }
}
  </style>
</head>
<!-- ... Ù‡Ù…ÙˆÙ† head Ùˆ CSS -->

<body>

  <a href="index3.html" class="back-button" title=" voltar">
    <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="10" />
      <polyline points="12 8 8 12 12 16" />
      <line x1="16" y1="12" x2="8" y2="12" />
    </svg>
  </a>

  
  <!-- Ù„ÙˆÚ¯Ùˆ Ø¯Ø± Ù…Ø±Ú©Ø² -->
 <div class="logo">
  <img src="images/icon.png" alt="Logo" />
</div>
</div>
 


  <!-- Hamburger Icon -->
  <div class="hamburger" onclick="toggleMenu()">
    <div></div>
    <div></div>
    <div></div>
  </div>
  
  <!-- Drop-down Menu -->
  <div class="glass-menu" id="glassMenu">
    <ul>
      <li onclick="toggleSubMenu(this)">ESTÃ‰TICA CORPORAL
        <ul class="submenu">
  
          <li><a href="programadetox.html">Programa Detox</a></li>
          <li><a href="programaredutor.html">Programa Redutor</a></li>
  
          <li><a href="programamodelador.html">Programa Modelador</a></li>
        </ul>
      </li>
      <li onclick="toggleSubMenu(this)">CAPILAR
        <ul class="submenu">
  
          <li><a href="RecontruÃ§Ã£ocapilar.html">RecontruÃ§Ã£o Capilar</a></li>
          <li><a href="tratamentocapilar.html">tratamento Capilar</a></li>
  
        </ul>
      </li>
      <li><a href="depilacaoalaser.html">DEPILAÃ‡ÃƒO A LASER</a></li>
      <li><a href="HIFU12.HTML">HIFU 12D</a></li>
  
      <li><a href="unhas.html">UNHAS</a></li>
      <li><a href="bemestar.html">BEM-ESTAR</a></li>
      
      <li><a href="limpezapele.html">LIMPEZA A PELE</a></li>
      <li><a href="voucher.html">VOUCHER</a></li>
      <li><a href="contacto.html">CONTACTO</a></li>
    </ul>
  </div>
  
  
  <script>
    function toggleMenu() {
      document.getElementById('glassMenu').classList.toggle('open');
    }
  
    function toggleSubMenu(item) {
      const submenu = item.querySelector('.submenu');
      if (submenu) {
        submenu.style.display = submenu.style.display === 'block' ? 'none' : 'block';
      }
    }
  </script>




    <div class="container">
      <h2>Reserva de HorÃ¡rio</h2>
  
      <!-- Ù…Ø±Ø­Ù„Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ ÛŒØ§ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ radio -->
      <div id="step-client">
        <label>VocÃª Ã© cliente atual?</label><br>
        <label><input type="radio" name="clientType" value="old"> Sim</label>
        <label><input type="radio" name="clientType" value="new"> NÃ£o</label>
        <button id="clientTypeBtn" disabled>Continuar</button>
      </div>
  
      <div id="step-code" style="display:none">
        <label for="clientCode">CÃ³digo do Cliente:</label>
        <input type="text" id="clientCode">
        <button onclick="validateCode()">Validar CÃ³digo</button>
        <p id="codeMessage" style="color: #ff6666;"></p>
      </div>
  
      <form id="newClientForm" style="display:none">
        <label>Nome:</label><input type="text" id="name" required>
        <label>Email:</label><input type="email" id="email" required>
        <label>Telefone:</label><input type="text" id="phone" required>
        <label>Qual e o serviÃ§o que mais usa</label>
        <select id="nationality">
          
         
          <option> corporal </option>
          <option> facial</option>
          
        </select>
        <label>Data de Nascimento:</label><input type="date" id="birth" required>
        <input type="hidden" id="vipCode" name="vipCode">

       
        <button type="button" onclick="showCalendar()">PrÃ³ximo</button>
      </form>
  
      <div id="calendarStep" style="display:none">
    
        <label>Escolha a data:</label>
        <input type="text" id="datepicker" readonly>
        <div id="slots"></div>
        <button id="confirmButton">Confirmar e Agendar </button>
        <p id="message" style="color: #ff6666;"></p>
      </div>
    </div>
  
    
  <!-- Ù¾ÛŒØ§Ù… Ù…ÙˆÙÙ‚ÛŒØª ÛŒØ§ Ø®Ø·Ø§ Ø¨Ø±Ø§ÛŒ Ú©Ø¯ Ù…Ø´ØªØ±ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ -->
<div id="codeValidationResult" style="display:none; margin-top: 20px; padding: 15px; border-radius: 10px; background: rgba(255,255,255,0.2); color: white; text-align: center;"></div>

    <script src="https://cdn.jsdelivr.net/npm/pikaday/pikaday.js"></script>
    <script>
      const service = new URLSearchParams(window.location.search).get("service") || "";
      const ref = new URLSearchParams(window.location.search).get("ref") || "";
      const webhookValidate = "https://hook.eu2.make.com/zuqc1rgie7toaw9rll92p3mdgfsv1bld";
      const webhookAvailable = "https://hook.eu2.make.com/l7ns23v63g27prryvriwikp7bh1j75vu";
      const webhookReserveNewClient = "https://hook.eu2.make.com/2i4jvjo24m07632lbwbduvulrpy760w3";
      const webhookReserveOldClient = webhookReserveNewClient; // Ø§Ú¯Ø± ÛŒÚ©ÛŒ Ù‡Ø³Øª Ú©Ù‡ Ø§ÛŒØ±Ø§Ø¯ÛŒ Ù†Ø¯Ø§Ø±Ù‡
  
      const allHours = [
        "09:00", "10:00", "11:00", "12:00",
        "13:00", "14:00", "15:00", "16:00", "17:00", "18:00"
      ];
  
      let isOldClient = false;
      let clientInfo = {};
      let selectedSlot = { date: null, hour: null };
      let pikadayInstance = null;
  
      // Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù†ØªØ®Ø§Ø¨ radio Ø¨Ø±Ø§ÛŒ Ù…Ø´ØªØ±ÛŒ
      const clientTypeRadios = document.querySelectorAll('input[name="clientType"]');
      const clientTypeBtn = document.getElementById("clientTypeBtn");
  
      clientTypeRadios.forEach(radio => {
        radio.addEventListener('change', () => {
          clientTypeBtn.disabled = false;
        });
      });
  
      clientTypeBtn.addEventListener('click', () => {
  const selected = document.querySelector('input[name="clientType"]:checked').value;
  isOldClient = selected === "old";
  document.getElementById('step-client').style.display = 'none';

  const randomCode = "vip_" + Math.floor(100000 + Math.random() * 900000);
  document.getElementById("vipCode").value = randomCode;

  if (isOldClient) {
    document.getElementById('step-code').style.display = 'block';
  } else {
    document.getElementById('newClientForm').style.display = 'block';
  }
});

      async function validateCode() {
        const code = document.getElementById('clientCode').value.trim();
        if (!code) {
          document.getElementById('codeMessage').textContent = "Por favor, insira o cÃ³digo.";
          return;
        }
        document.getElementById('codeMessage').textContent = "Validando...";
        try {
          const res = await fetch(webhookValidate, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ code })
          });
          const result = await res.json();
          if (result.success) {
            clientInfo = result.client || {};
            clientInfo.code = code; // Ø­ØªÙ…Ø§ Ú©Ø¯ Ø±Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†
            document.getElementById('step-code').style.display = 'none';
            document.getElementById('calendarStep').style.display = 'block';
            initCalendar();
          } else {
            document.getElementById('codeMessage').textContent = 'CÃ³digo invÃ¡lido.';
          }
        } catch (e) {
          document.getElementById('codeMessage').textContent = 'Erro ao validar cÃ³digo.';
          console.error(e);
        }
      }
  
      function showCalendar() {
        // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙØ±Ù… Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯
        const name = document.getElementById('name').value.trim();
        const email = document.getElementById('email').value.trim();
        const phone = document.getElementById('phone').value.trim();
        const birth = document.getElementById('birth').value.trim();
        
        if (!name || !email || !phone || !birth) {
          alert("Por favor, preencha todos os campos.");
          return;
        }
        document.getElementById('newClientForm').style.display = 'none';
        document.getElementById('calendarStep').style.display = 'block';
        initCalendar();
      }
  
      function initCalendar() {
  if (pikadayInstance) return; // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø³Ø§Ø®Øª Ú†Ù†Ø¯Ø¨Ø§Ø±Ù‡
  
  // Ù…Ø­Ø§Ø³Ø¨Ù‡â€ŒÛŒ ØªØ§Ø±ÛŒØ® Ù…Ø¬Ø§Ø² Ø§Ø² Ø¯Ùˆ Ø±ÙˆØ² Ø¨Ø¹Ø¯
  const today = new Date();
  const minSelectableDate = new Date(today);
  minSelectableDate.setDate(today.getDate() + 3); // â† Ø§Ù…Ø±ÙˆØ² + 3 = Ø§Ø² 17Ø§Ù… Ù‚Ø§Ø¨Ù„ Ø±Ø²Ø±Ùˆ (14 + 3 = 17)
  
  pikadayInstance = new Pikaday({
    field: document.getElementById('datepicker'),
    format: 'DD/MM/YYYY',
    minDate: minSelectableDate, // âœ… Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯
    onSelect(date) {
      const year = date.getFullYear();
      const month = (date.getMonth() + 1).toString().padStart(2, '0');
      const day = date.getDate().toString().padStart(2, '0');
      const formattedDate = `${year}-${month}-${day}`;
      selectedSlot.date = formattedDate;
      fetchAvailableSlots(formattedDate);
    }
  });
}

  
      function renderTimeSlots(unavailable = []) {
        const container = document.getElementById("slots");
        container.innerHTML = "";
  
        allHours.forEach(hour => {
          const btn = document.createElement("button");
          btn.type = "button";
          btn.classList.add("slot-button");
          btn.textContent = hour;
  
          if (unavailable.includes(hour)) {
            btn.disabled = true;
            btn.title = "Ø§ÛŒÙ† Ø³Ø§Ø¹Øª Ù‚Ø¨Ù„Ø§Ù‹ Ø±Ø²Ø±Ùˆ Ø´Ø¯Ù‡ Ø§Ø³Øª.";
            btn.style.opacity = 0.5;
          } else {
            btn.addEventListener("click", () => {
              selectedSlot.hour = hour;
              document.querySelectorAll(".slot-button").forEach(b => b.classList.remove("selected"));
              btn.classList.add("selected");
            });
          }
  
          container.appendChild(btn);
        });
      }
  

      const serviceToMachine = {
  "HIFU 12D FACIAL": "HIFU",
  "HIFU12 CORPORAL": "HIFU",
  "HIFU 12 Corporal": "HIFU",
  "Lipo CavitaÃ§Ã£o": "LIPO",
  "RadiofrequÃªncia Facial": "RADIO",
  "Massagem Desportiva": "MANUAL",
  "Drenagem LinfÃ¡tica": "MANUAL",
  // ... Ù‡Ø± Ø³Ø±ÙˆÛŒØ³ Ø¯ÛŒÚ¯Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø¯Ø§Ø±ÛŒ
};



async function fetchAvailableSlots(date) {
  if (!date) return;
  try {
    const machine = serviceToMachine[service] || service; // Ù†ÙˆØ¹ Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø±ÙˆÛŒØ³

    const res = await fetch(webhookAvailable, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ date, service, machine, ref })
    });

    const data = await res.json();

    let unavailable = [];
    if (data.unavailableHours && data.unavailableHours.length > 0) {
      unavailable = data.unavailableHours[0]
        .split(",")
        .map(hour => hour.trim())
        .filter(hour => hour !== "");
    }

    renderTimeSlots(unavailable);
  } catch (e) {
    console.error("Erro ao buscar horÃ¡rios disponÃ­veis", e);
    renderTimeSlots();
  }
}


  

document.getElementById("confirmButton").addEventListener("click", async () => {
  if (!selectedSlot.date || !selectedSlot.hour) {
    document.getElementById("message").textContent = "Por favor, selecione data e hora.";
    return;
  }

  document.getElementById("message").textContent = "Enviando reserva...";


  // ğŸ‘‡ Ø§ÛŒÙ† Ù‚Ø³Ù…Øª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡
  
  const serviceToMachine = {
  "HIFU 12D FACIAL": "HIFU",
  "HIFU12 CORPORAL": "HIFU",
  
  "Lipo CavitaÃ§Ã£o": "LIPO",
  "RadiofrequÃªncia Facial": "RADIO",
  "Massagem Desportiva": "MANUAL",
  "Drenagem LinfÃ¡tica": "MANUAL",
  // ... Ù‡Ø± Ø³Ø±ÙˆÛŒØ³ Ø¯ÛŒÚ¯Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø¯Ø§Ø±ÛŒ
};

  const machine = serviceToMachine[service] || service; // Ø§Ú¯Ø± ØªÙˆ Ø¬Ø¯ÙˆÙ„ Ø¨Ø§Ù„Ø§ Ù†Ø¨ÙˆØ¯ØŒ Ø®ÙˆØ¯Ø´ ÙØ±Ø³ØªØ§Ø¯Ù‡ Ù…ÛŒØ´Ù‡



  let payload = {
    service,
    ref,
    date: selectedSlot.date,
    hour: selectedSlot.hour,
    machine,
    
  };

  // âœ… Ù†Ù…Ø§ÛŒØ´ ÙÙˆØ±ÛŒ Ù¾ÛŒØ§Ù… Ù…ÙˆÙÙ‚ÛŒØª
  document.getElementById("calendarStep").innerHTML = `
    <div style="padding: 30px; text-align: center;">
      <h3 style="color: #00ffcc;">âœ… Reserva confirmada com sucesso!</h3>
      <p style="margin-top: 10px;">Seu horÃ¡rio foi reservado para <strong>${selectedSlot.date}</strong> Ã s <strong>${selectedSlot.hour}</strong>.</p>
      <p>VocÃª receberÃ¡ um e-mail com os detalhes em breve.</p>
    </div>
  `;

  // Ø§Ø±Ø³Ø§Ù„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ webhook Ù…Ø«Ù„ Ù‚Ø¨Ù„ (Ø¨Ø¯ÙˆÙ† Ø§Ù†ØªØ¸Ø§Ø± Ù¾Ø§Ø³Ø®)
  try {
    if (isOldClient) {
      payload.clientInfo = clientInfo;
      if (!payload.clientInfo.code)
        payload.clientInfo.code = document.getElementById('clientCode').value.trim();

      fetch(webhookReserveOldClient, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      }).catch(e => console.error("Erro ao enviar reserva (cliente antigo):", e));

    } else {
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const nationality = document.getElementById('nationality').value;
      const birth = document.getElementById('birth').value;
      const code = document.getElementById("vipCode").value.trim();
      payload.clientInfo = { name, email, phone, nationality, birth, code, ref };

      fetch(webhookReserveNewClient, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      }).catch(e => console.error("Erro ao enviar reserva (novo cliente):", e));
    }
  } catch (e) {
    console.error("Erro geral ao enviar:", e);
  }
});
</script>



  </body>
  
</html>
