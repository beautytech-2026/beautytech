<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Influencer Login</title>
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn&display=swap" rel="stylesheet">
<style>
  body {
    background: linear-gradient(to bottom right, #dd0583, #8e2de2);
    font-family: 'Vazirmatn', sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    margin: 0;
  }
  .card {
    width: 380px;
    background: rgba(255,255,255,0.08);
    backdrop-filter: blur(8px);
    border-radius: 14px;
    padding: 28px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.25);
    color: #fff;
    text-align: center;
  }
  h2 { margin: 0 0 18px; font-size: 20px; }
  input {
    width: 100%;
    padding: 12px;
    margin: 10px 0;
    border-radius: 10px;
    border: none;
    background: rgba(255,255,255,0.12);
    color: #c13a8f;
    font-size: 15px;
  }
  button {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    border-radius: 10px;
    border: none;
    background: #c02190;
    color: #fff;
    font-weight: 700;
    cursor: pointer;
  }
  button:hover { background: #e338b2; }
  .error { color: #ff8b8b; margin-top: 10px; font-size: 0.95rem; }
  .small { margin-top: 8px; color: rgba(255,255,255,0.85); font-size:0.9rem;}
</style>
</head>
<body>

<div class="card">
  <h2>Influencer Login</h2>

  <input id="email" type="email" placeholder="Email" autocomplete="username" />
  <input id="password" type="password" placeholder="Password" autocomplete="current-password" />

  <button id="loginBtn" onclick="login()">Login</button>

  <p id="error" class="error"></p>
  <p class="small">Enter the email and password registered in the users sheet.</p>
</div>

<script>
async function login(){
  const email = document.getElementById('email').value.trim().toLowerCase();
  const pass = document.getElementById('password').value.trim();
  const errEl = document.getElementById('error');
  errEl.textContent = '';

  if(!email || !pass){ errEl.textContent = 'Please fill all fields.'; return; }

  // ---- REPLACE this with your actual "users" WebApp URL ----
  // Example: const USERS_WEBAPP_URL = "https://script.google.com/macros/s/..../exec";
  const USERS_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzcLzul1ep4_zg20kIcJmjGS-hDZ_oIiuIdCvFLkETzdzuvKVuv33JcpUq2nhOzpQTG/exec";
  // ---------------------------------------------------------

  try {
    // Use GET so it works with simple doGet apps (no CORS/POST complications)
    const url = `${USERS_WEBAPP_URL}?email=${encodeURIComponent(email)}&pass=${encodeURIComponent(pass)}`;
    const res = await fetch(url);
    if (!res.ok) throw new Error('network');

    const json = await res.json();

    // Expect { ok: true, data: { ... } }  (as in our appscript)
    if (!json.ok) {
      errEl.textContent = 'Email or password incorrect.';
      return;
    }

    // Save user data and ref for dashboard
    // the appscript returns row object (headers as keys). Adapt if your keys differ.
    const user = json.data;
    // normalize ref key (accept both "ref" and "Ref")
    const ref = (user.ref || user.Ref || user['Ref'] || '').toString().trim();

    // store full user and ref
    localStorage.setItem('userData', JSON.stringify(user));
    localStorage.setItem('userRef', ref);

    // go to dashboard (same folder)
    window.location.href = 'dashboard.html';

  } catch (e) {
    console.error(e);
    errEl.textContent = 'Error connecting to server. Make sure the Users WebApp URL is correct and deployed (Anyone, even anonymous).';
  }
}
</script>

</body>
</html>
